<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <title>Liturgie dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="/styles.css" />
</head>
<body class="dashboard-body">
  <main class="dashboard-container">
    <header class="dashboard-header">
      <h1>Liturgie dashboard</h1>
      <p>
        Pas hieronder de liturgietekst aan.<br>
        Gebruik <code>Enter</code> voor nieuwe regels.<br>
        Alles wat je hier opslaat, verschijnt op <code>/liturgie</code>.
      </p>
    </header>
    <section class="dashboard-form">
      <label for="liturgie-tekst">Liturgietekst</label>
      <textarea id="liturgie-tekst" placeholder="Bijv.&#10;Psalm 42: 1-3&#10;Schriftlezing: Johannes 3: 16-21&#10;Preek&#10;Psalm 130: 1-4"></textarea>
      <button id="opslaan-knop">Opslaan</button>
      <div id="save-status" class="save-status"></div>
    </section>
  </main>
  <script>
    const textarea = document.getElementById("liturgie-tekst");
    const saveBtn = document.getElementById("opslaan-knop");
    const statusEl = document.getElementById("save-status");

    async function laadLiturgieVoorDashboard() {
      try {
        const res = await fetch("/api/get-liturgie");
        const data = await res.json();
        textarea.value = data.tekst || "";
      } catch (err) {
        console.error(err);
        statusEl.textContent = "Fout bij laden van liturgie.";
      }
    }

    async function opslaan() {
      try {
        saveBtn.disabled = true;
        statusEl.textContent = "Bezig met opslaan...";

        const res = await fetch("/api/set-liturgie", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ tekst: textarea.value })
        });

        const data = await res.json();

        if (data.ok) {
          statusEl.textContent = "Opgeslagen! (verversing op /liturgie binnen ~10s)";
        } else {
          statusEl.textContent = "Fout bij opslaan.";
        }
      } catch (err) {
        console.error(err);
        statusEl.textContent = "Fout bij opslaan.";
      } finally {
        saveBtn.disabled = false;
      }
    }

    saveBtn.addEventListener("click", opslaan);

    laadLiturgieVoorDashboard();
  </script>
</body>
</html>
